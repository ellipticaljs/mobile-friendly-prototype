!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("elliptical-utils"),require("elliptical-class"),require("dustjs"),require("elliptical-dust-helpers")):"function"==typeof define&&define.amd?define(["elliptical-utils","elliptical-class","dustjs","elliptical-dust-helpers"],t):(e.elliptical.$Template=t(e.elliptical.utils,e.elliptical.Class,e.dust,e.dust.helpers),e.returnExports=e.elliptical.$Template)}(this,function(e,t,r,i){function o(e,t){for(var r=a(e._root),i=t.split("."),o=0;o<i.length;o++)r+="/"+i[o];return r+=".html"}function n(e,t,r){var i=o(e,t);$.get(i,function(i){if(i){var o=e.compile(i,t);e.loadSource(o),r(null,i)}else r(new Error("Error: cannot find "+t+" in views folder"),null)})}function s(e,t,r,i,o){var n=a(e.root),s=n+"/"+t+"/"+r+".html",c=t+"."+r,l=e.$provider;$.get(s,function(e){if(e){var t=l.compile(e,c);l.loadSource(t),l.render(c,i,o)}else o("Error: Controller View does not exist",null)})}function c(e,t,r,i){var o=e.$provider,n=o.cache;p.isEmpty(n)?l(e.model,e.$store,o,e.api,function(){o.render(t,r,i)}):o.render(t,r,i)}function l(e,t,i,o,n){if(t)t.getAll(e,function(e,t){for(var i=0,o=t.length;o>i;i++){var s=JSON.parse(t[i]);r.loadSource(s)}n&&n()});else var s=d,c=0,l=setInterval(function(){var e=i.cache;p.isEmpty(e)?(c++,c>s&&n&&n()):(clearInterval(l),n&&n())},u)}function a(e){return"/"===h.lastChar(e)?h.trimLastChar(e):e}var u=250,d=5,f="/views",p=e.object,h=e.string,b=e.network;r.optimizers.format=function(e,t){return t},r._root=f,r.onLoad=function(e,t){if(e.indexOf(".")>-1)n(r,e,t);else{var i=new Error("Partial Not Found: "+e);t(i,null)}};var v;return v=t.extend({_data:{},_$store:null,get $store(){return this._$store},set $store(e){this._$store=e},_base:{server:"base",client:"base-client"},get base(){return this._base},set base(e){this._base=e},_$provider:r,get $provider(){return this._$provider},set $provider(e){this._$provider=e,this._$provider._root=this._root},compile:r.compile,cache:r.cache,_model:"template",get model(){return this._model},set model(e){this._model=e},_api:"/api/template",get api(){return this._api},set api(e){this._api=e},_root:f,get root(){return this._root},set root(e){this._root=e,this._$provider._root=e},getBase:function(){return b.isBrowser()?this.base.client:this.base.server},render:function(e,t,r){var i=this.$provider,o=i.cache,l=!1;if(l=o?p.isEmpty(o):!0,!l&&void 0!==o[e])return void i.render(e,t,r);if("object"==typeof e){var a=e.name.toLowerCase(),u=e.view.toLowerCase(),d=a+"."+u;l?s(this,a,u,t,r):o[d]?i.render(d,t,r):s(this,a,u,t,r)}else e.indexOf(".")>-1?n(i,e,function(){i.render(e,t,r)}):c(this,e,t,r)},setBrowserGlobal:function(){"undefined"!=typeof window&&(window.dust=this.$provider)}},{init:function(e){e&&(this.constructor._data.base=!0),this.root=this.constructor.root},render:function(e,t,r){if(this.constructor._data.base){var i={render:this.constructor.getBase()},o=this.constructor.$provider.makeBase(i);t=o.push(t)}this.constructor.render(e,t,r)}})});